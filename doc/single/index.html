<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>ardj</title><link rel="stylesheet" href="screen.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.75.2" /><meta name="description" content="Программный комплекс ardj предназначен для создания полностью автоматизированной интернет-радиостанции, управляемой пользователями, с минимальным адмнистрированием или вообще без него. Комплекс позволяет составлять умные плейлисты произвольной сложности, получать звуковые файлы из внешних источников, управлять эфиром через jabber и многое другое.  В целом комплекс настроен на создание полностью автономной радиостанции; если вам нужен контроль над плейлистом с точностью до секунды и полностью ручное управление, вам больше подойдёт такое ПО, как SAM Broadcaster или Internet DJ Console. Это руководство содержит всю информацию, необходимую для работы запуска радиостанции, основанной на ardj, и работы с ней." /></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="ru" class="book" title="ardj" xml:lang="ru"><div class="titlepage"><div><div><h1 class="title"><a name="id2505428" id="id2505428"></a>ardj</h1></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Justin</span> <span class="surname">Forest</span></h3></div></div></div><div><p class="releaseinfo">1.0.1</p></div><div><div class="abstract" title="Аннотация"><p class="title"><b>Аннотация</b></p><p>Программный комплекс <span class="application">ardj</span> предназначен для создания полностью автоматизированной
      интернет-радиостанции, управляемой пользователями, с минимальным адмнистрированием или вообще без него.</p><p>Комплекс позволяет составлять умные плейлисты произвольной сложности, получать звуковые файлы из внешних
      источников, управлять эфиром через jabber и многое другое.  В целом комплекс настроен на создание полностью
      автономной радиостанции; если вам нужен контроль над плейлистом с точностью до секунды и полностью ручное
      управление, вам больше подойдёт такое ПО, как SAM Broadcaster или Internet DJ Console.</p><p>Это руководство содержит всю информацию, необходимую для работы запуска радиостанции, основанной на ardj, и
      работы с ней.</p></div></div></div><hr /></div><div class="toc"><p><b>Содержание</b></p><dl><dt><span class="chapter"><a href="#quickstart">1. Быстрый запуск</a></span></dt><dt><span class="chapter"><a href="#settings">2. Настройка</a></span></dt><dd><dl><dt><span class="section"><a href="#last-fm">Взаимодействие с Last.fm</a></span></dt></dl></dd><dt><span class="chapter"><a href="#command-line">3. Параметры командной строки</a></span></dt></dl></div><div class="chapter" title="Глава 1. Быстрый запуск"><div class="titlepage"><div><div><h2 class="title"><a name="quickstart" id="quickstart"></a>Глава 1. Быстрый запуск</h2></div></div></div><p>В этом разделе описывается последовательность действий по запуску радиостанции на примере операционной системы
    Ubuntu Linux.  Действия для других операционных систем аналогичны, с поправкой на использование местного менеджера
    пакетов и названий некоторых пакетов.  Предполагается, что пользователь умеет редактировать текстовые файлы.</p><p>Сначала нужно установить используемые системные пакеты:</p><pre class="programlisting">sudo apt-get install python-yaml python-mutagen \
  python-oauth python-feedparser python-httplib2
  python-webpy python-dnspython python-socksipy \
  ices icecast2 python-simplejson</pre><p>Затем нужно скачать и установить пакет ardj:</p><pre class="programlisting">wget http://ardj.googlecode.com/files/ardj-1.0-2011.08.12.0215.deb
sudo dpkg -i ardj-1.0-2011.08.12.0215.deb</pre><p>Теперь нужно скопировать из примеров конфигурационные файлы для ices0 и icecast2:</p><pre class="programlisting">sudo cp /usr/share/doc/ardj/examples/icecast.xml /etc/icecast2/
sudo cp /usr/share/doc/ardj/examples/ices.conf /etc/</pre><p>Теперь можно запустить все службы:</p><pre class="programlisting">sudo service icecast2 start
  sudo start ardj-server
  sudo start ardj-ices</pre><p>Готово.  Станция должна работать.  Чтобы убедиться в этом, подключитесь к основному потоку:</p><pre class="programlisting">mplayer http://127.0.0.1:8180/live.mp3</pre><p>После этого обычно в файлах <code class="filename">icecast.xml</code> и <code class="filename">ices.conf</code> меняют пароли
    для подключения к вещанию, в файле <code class="filename">/etc/ardj.yaml</code> указать параметры доступа к джабберу и <a class="link" href="#last-fm" title="Взаимодействие с Last.fm">Last.fm</a>, и создают более сложные плейлисты.</p></div><div class="chapter" title="Глава 2. Настройка"><div class="titlepage"><div><div><h2 class="title"><a name="settings" id="settings"></a>Глава 2. Настройка</h2></div></div></div><div class="toc"><p><b>Содержание</b></p><dl><dt><span class="section"><a href="#last-fm">Взаимодействие с Last.fm</a></span></dt></dl></div><div class="section" title="Взаимодействие с Last.fm"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="last-fm" id="last-fm"></a>Взаимодействие с Last.fm</h2></div></div></div><p>Взаимодействие с Last.fm двунаправленное: робот отправляет на сервер информацию о проигрываемых и «любимых»
      композициях, а от сервера получает информацию для коррекции имён исполнителей и свежую музыку.  Чтобы всё это
      работало, в конфигурационный файл нужно добавить такой блок:</p><pre class="programlisting">last.fm:
  key: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
  secret: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
  login: alice
  password: secret</pre><p>Параметры <code class="option">key</code> и <code class="option">secret</code> можно получить после <a class="ulink" href="http://www.lastfm.ru/api/account" target="_top">регистрации собственного приложения</a> (процедура бесплатна и занимает
      несколько минут).</p><p>Для включения скробблинга в конфигурационный файл следует добавить такую строку:</p><pre class="programlisting">last_fm_scrobble: true</pre><p>Чтобы исключить из процесса скробблинга композиции с определёнными метками (например, джинглы), укажите их в
      параметре <code class="option">last_fm_skip_labels</code> конфигурационного файла:</p><pre class="programlisting">last_fm_skip_labels: [jingle, quotes, news, special]</pre><p>Наконец, чтобы знать, откуда пришла новая музыка, можно добавить к файлам, загруженным из Last.fm,
      специальные метки.  Для этого их нужно указать в параметре <code class="option">last_fm_add_labels</code> конфигурационного
      файла:</p><pre class="programlisting">last_fm_add_labels: [tagme, source:last.fm]</pre></div></div><div class="chapter" title="Глава 3. Параметры командной строки"><div class="titlepage"><div><div><h2 class="title"><a name="command-line" id="command-line"></a>Глава 3. Параметры командной строки</h2></div></div></div><p>Интерфейс ко всем функциям предоставляет программа <span class="command"><strong>ardj</strong></span>.  Эта программа первым параметром
    принимает имя команды, которое может сопровождаться дополнительными параметрами.  Все команды и возможные параметры
    описаны в этом разделе.</p><p>При использовании оболочек <span class="command"><strong>bash</strong></span> и <span class="command"><strong>zsh</strong></span> работает автодополнение команд и
    параметров, можно использовать кнопку TAB для ускоренного набора.</p><div class="variablelist"><dl><dt><span class="term"><code class="option">add-incoming-tracks</code></span></dt><dd><p>Ищет файлы в папке, указанной в параметре <code class="option">incoming_path</code> конфигурационного файла.  Все
          найденные файлы с расширениями <code class="filename">.mp3</code> и <code class="filename">.ogg</code> перемещаются в медиатеку
          и удаляются.  Если файл не может быть удалён — он игнорируется (чтобы не добавлять его повторно при каждом
          последующем вызове).</p><p>При копировании в медиатеку из метаданных файлов считываются значения тэгов "artist" и "title",
          остальные привычные тэги игнорируются.  Из непривычных поддерживается тэг "ardj", который может содержать
          метки, пример значения: "ardj=1;labels=music,rock,loud".</p><p>Эта команда является эквивалентом команды <span class="command"><strong>upload</strong></span> джаббера.</p></dd><dt><span class="term"><code class="option">config</code></span></dt><dd><p>Запускает текстовый редактор с открытым для редактирования конфигурационным файлом.</p></dd><dt><span class="term"><code class="option">console [jid]</code></span></dt><dd><p>Открывает интерактивную консоль, эмулирующую общение через джаббер (только без джаббера и вообще без
          использования сети).  Эта функция полезна для отладки, например, когда пользователь жалуется на неожиданное
          поведение команды, которое не воспроизводится у других пользователей.</p></dd><dt><span class="term"><code class="option">db-console</code></span></dt><dd><p>Открывает интерактивную консоль для работы с базой данных, SQLite или MySQL.  Может использоваться в
          скриптах (запросы надо передавать через stdin).</p></dd><dt><span class="term"><code class="option">db-init</code></span></dt><dd><p>Инициализация недостающих таблиц и индексов базы данных.  Эта процедура обычно выполняется при установке
          пакета и больше не нужна.  Выполнить её вручную может понадобиться, например, если вы случайно уничтожили базу
          данных и хотите начать сначала.</p></dd><dt><span class="term"><code class="option">db-purge</code></span></dt><dd><p>Удаляет из базы данных мусор, вроде неиспользуемых меток и файлов, относящихся к дорожкам, которые были
          удалены.</p></dd><dt><span class="term"><code class="option">db-stats</code></span></dt><dd><p>Показывает информацию о количестве композиций и их суммарной продолжительности, например: "2883 tracks,
          192.0 hours".</p></dd><dt><span class="term"><code class="option">download-artist name</code></span></dt><dd><p>Сохраняет запрос на загрузку песен указанного исполнителя.  Сама загрузка выполняется позже, в фоновом
          режиме.</p><p>Эта команда является эквивалентом команды <span class="command"><strong>download</strong></span> джаббера.</p></dd><dt><span class="term"><code class="option">find-new-tracks</code></span></dt><dd><p>Запускает поиск новой музыки.  Сначала выбираются исполнители, имеющие дорожки с оценками выше средней,
          затем в Last.fm и Jamendo ищется новая музыка этих исполнителей, которую позволено скачивать.</p></dd><dt><span class="term"><code class="option">fix-artist-names</code></span></dt><dd><p>Проверяет имя исполнителя по базе данных Last.fm и исправляет, если сервер рекомендует это.  Обычно это
          приводит к изменению регистра, но может и полностью заменить имя, например, исправив ложную
          транслитерацию.</p></dd><dt><span class="term"><code class="option">help</code></span></dt><dd><p>Выводит краткую сводку по поддерживаемым командам.</p></dd><dt><span class="term"><code class="option">mark-hitlist</code></span></dt><dd><p>Отмечает примерно десяток лучших песен меткой "hitlist".  Реальное количество дорожек обычно чуть
          больше, потому что отмечаются все дорожки с рейтингом не ниже десятой по счёту (то есть на десятом месте может
          быть несколько дорожек).</p><p>Если настроено взаимодействие с Last.fm, отмеченные дорожки добавляются в «любимые».</p></dd><dt><span class="term"><code class="option">mark-liked-by label jid1 jid2 ...</code></span></dt><dd><p>Отмечает меткой "label" композиции, которые нравятся всем указанным пользователям.  Эту команду можно
          использовать для создания специфической атмосферы перед прямыми включениями, когда известны будущие
          участники.</p></dd><dt><span class="term"><code class="option">mark-long</code></span></dt><dd><p>Отмечает меткой "long" композиции с продолжительностью выше средней.  Можно использовать метку для
          исключения слишком длинных песен из дневной ротации.</p></dd><dt><span class="term"><code class="option">mark-orphans</code></span></dt><dd><p>Отмечает меткой "orphan" композиции, не находящиеся ни в одном плейлисте.</p></dd><dt><span class="term"><code class="option">merge-votes</code></span></dt><dd><p>Склеивает голоса пользователей в соответствии со значением параметра <code class="option">jabber_aliases</code>
          конфигурационного файла.</p></dd><dt><span class="term"><code class="option">queue-flush</code></span></dt><dd><p>Очищает очередь заказов.</p></dd><dt><span class="term"><code class="option">scan-replaygain [files...]</code></span></dt><dd><p>Запускает сканирование ReplayGain для всех файлов, у которых нет нужной информации.  Если параметр
          <code class="option">files</code> не указан — сканирует все файлы в медиатеке.</p><p>Для сканирования используются программы <span class="command"><strong>mp3gain</strong></span> и
          <span class="command"><strong>vorbisgain</strong></span>.</p></dd><dt><span class="term"><code class="option">serve</code></span></dt><dd><p>Запускает веб-сервер для доступа к Web API.  Сервер обычно доступен по адресу localhost:8080, но этот
          адрес может быть изменён параметром <code class="option">api_socket</code> конфигурационного файла.  Сервер используется
          плагином для <span class="command"><strong>ices</strong></span> и некоторыми командами джаббера.</p><p>Запускать сервер вручную может понадобиться только в отладочных целях.  В повседневной работе его
          запускает системная служба, ещё это можно сделать командой <span class="command"><strong>sudo start ardj-server</strong></span> (по
          умолчанию команда доступна без пароля всем пользователям из группы "ardj").</p></dd><dt><span class="term"><code class="option">tags files...</code></span></dt><dd><p>Выводит содержимое поддерживаемых тэгов.  Эта функция обычно используется в отладочных целях, чтобы
          убедиться в работоспособности функции чтения тэгов и в корректности самих тэгов.  Для работы используется
          библиотека <a class="ulink" href="http://code.google.com/p/mutagen/" target="_top">python-mutagen</a>.</p></dd><dt><span class="term"><code class="option">twit "text..."</code></span></dt><dd><p>Отправляет указанный текст в Твиттер.  Работает только при корректном заполнении параметра
          <code class="option">twitter</code> конфигурационного файла, в противном случае пишет что делать.</p></dd><dt><span class="term"><code class="option">twit-replies</code></span></dt><dd><p>Выводит сообщения, отправленные на имя используемой учётной записи.  Предположительно бесполезная
          функция.</p></dd><dt><span class="term"><code class="option">update-schedule</code></span></dt><dd><p>Собирает на Last.fm информацию о предстоящих концертах интересных исполнителей (имеющих дорожки с
          оценками выше средней) и сохраняет её в файл типа JavaScript, указанный в параметре
          <code class="option">event_schedule_path</code> конфигурационного файла; этот файл можно использовать для вывода карты на
          сайте.</p><p>Работает только при корректной настройке взаимодействия с Last.fm.</p></dd><dt><span class="term"><code class="option">update-track-lengths</code></span></dt><dd><p>Сверяет продолжительность файлов с информацией из базы данных и корректирует её.  Полезно запускать
          после ручного вмешательства в медиатеку.</p></dd><dt><span class="term"><code class="option">update-track-weights</code></span></dt><dd><p>Сдвигает текущий рейтинг каждой дорожки к реальному.  Вредная функция; описанная процедура выполняется
          автоматически при каждом проигрывании, ручной запуск только сбивает рейтинги.</p></dd><dt><span class="term"><code class="option">xmpp-send "message text" [jid]</code></span></dt><dd><p>Отправляет сообщение указанному пользователю или в чат, если пользователь не указан (название комнаты
          указывается в параметре <code class="option">jabber_chat_room</code> конфигурационного файла).</p></dd></dl></div></div></div></body></html>
